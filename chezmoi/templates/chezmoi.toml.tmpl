{{- $profile := promptString "profile" "Choose your profile:\n  1) minimal - Just git and tmux basics\n  2) developer - + modern CLI tools (fzf, ripgrep, bat, zoxide)\n  3) power-user - Everything (recommended)\nEnter choice (1-3)" "2" -}}

{{- $profileMap := dict "1" "minimal" "2" "developer" "3" "power-user" -}}
{{- $selectedProfile := get $profileMap $profile | default "developer" -}}

{{- $gitName := promptString "git_name" "Git user name" (.chezmoi.username | default "Your Name") -}}
{{- $gitEmail := promptString "git_email" "Git email address" "" -}}

{{- $secretsBackend := promptString "secrets_backend" "Choose secrets backend:\n  1) env - Environment variables (simple)\n  2) op - 1Password (recommended)\n  3) bw - Bitwarden\n  4) file - File-based\nEnter choice (1-4)" "1" -}}
{{- $secretsMap := dict "1" "env" "2" "op" "3" "bw" "4" "file" -}}
{{- $selectedSecretsBackend := get $secretsMap $secretsBackend | default "env" -}}

[data]
    profile = "{{ $selectedProfile }}"
    
    [data.user]
        name = "{{ $gitName }}"
        email = "{{ $gitEmail }}"
    
    [data.secrets]
        backend = "{{ $selectedSecretsBackend }}"
        {{- if eq $selectedSecretsBackend "op" }}
        op_vault = "{{ promptString "op_vault" "1Password vault name" "Personal" }}"
        {{- else if eq $selectedSecretsBackend "bw" }}
        bw_server = "{{ promptString "bw_server" "Bitwarden server URL (press enter for default)" "https://vault.bitwarden.com" }}"
        {{- end }}
    
    [data.features]
        {{- if eq $selectedProfile "minimal" }}
        modern_cli = false
        developer_tools = false
        advanced_git = false
        powerline_prompt = false
        github_integration = false
        {{- else if eq $selectedProfile "developer" }}
        modern_cli = true
        developer_tools = true
        advanced_git = true
        powerline_prompt = false
        github_integration = true
        {{- else if eq $selectedProfile "power-user" }}
        modern_cli = true
        developer_tools = true
        advanced_git = true
        powerline_prompt = true
        github_integration = true
        auto_updates = true
        {{- end }}
    
    [data.tools]
        {{- if eq $selectedProfile "minimal" }}
        essential = ["git", "tmux"]
        optional = []
        {{- else if eq $selectedProfile "developer" }}
        essential = ["git", "tmux", "fzf", "ripgrep", "bat", "zoxide"]
        optional = ["gh", "exa"]
        {{- else if eq $selectedProfile "power-user" }}
        essential = ["git", "tmux", "fzf", "ripgrep", "bat", "zoxide", "exa", "entr", "gh", "delta", "fd"]
        optional = ["lazygit", "gitui", "bottom", "dust"]
        {{- end }}
    
    [data.paths]
        workspace = "{{ if eq .chezmoi.os "windows" }}C:\\Workspace{{ else }}~/workspace{{ end }}"
        dotfiles = "{{ .chezmoi.sourceDir }}"
        local_bin = "{{ if eq .chezmoi.os "windows" }}{{ .chezmoi.homeDir }}\\.local\\bin{{ else }}{{ .chezmoi.homeDir }}/.local/bin{{ end }}"
    
    [data.editor]
        default = "{{ env "EDITOR" | default "vim" }}"
        gui = "{{ if eq .chezmoi.os "windows" }}code{{ else if eq .chezmoi.os "darwin" }}code{{ else }}code{{ end }}"